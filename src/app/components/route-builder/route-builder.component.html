<!-- OGEN MODE UI -->
<ng-container *ngIf="routeType === 'ogen'">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Input -->
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-yellow-100">
                <h2 class="text-xl font-bold text-yellow-800 mb-4 flex items-center gap-2">
                    <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Nieuwe Stap
                </h2>

                <div class="space-y-6">
                    <!-- Theme Selector -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kies Thema</label>
                        <div class="flex flex-wrap gap-2">
                            <button *ngFor="let theme of ogenThemes" (click)="updateOgenTheme(theme.id)"
                                class="px-3 py-2 rounded-lg text-sm font-bold transition-colors border"
                                [ngClass]="ogenTheme === theme.id ? 'bg-yellow-500 text-white border-yellow-600 shadow-md' : 'bg-white text-gray-600 border-gray-200 hover:bg-yellow-50'">
                                {{ theme.label }}
                            </button>
                        </div>
                    </div>

                    <div class="border-t border-gray-200 my-4"></div>

                    <!-- Direction Buttons -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Richting</label>
                        <div class="grid grid-cols-3 gap-2">
                            <button (click)="ogenInput = 'left'"
                                class="flex flex-col items-center justify-center p-4 rounded-xl border-2 transition"
                                [ngClass]="ogenInput === 'left' ? 'border-yellow-500 bg-yellow-50 text-yellow-800' : 'border-gray-100 bg-white text-gray-500 hover:border-yellow-200'">
                                <lucide-icon [img]="ArrowLeft" class="w-8 h-8 mb-2"></lucide-icon>
                                <span class="font-bold">Links</span>
                            </button>

                            <button (click)="ogenInput = 'straight'"
                                class="flex flex-col items-center justify-center p-4 rounded-xl border-2 transition"
                                [ngClass]="ogenInput === 'straight' ? 'border-yellow-500 bg-yellow-50 text-yellow-800' : 'border-gray-100 bg-white text-gray-500 hover:border-yellow-200'">
                                <lucide-icon [img]="ArrowUp" class="w-8 h-8 mb-2"></lucide-icon>
                                <span class="font-bold">Rechtdoor</span>
                            </button>

                            <button (click)="ogenInput = 'right'"
                                class="flex flex-col items-center justify-center p-4 rounded-xl border-2 transition"
                                [ngClass]="ogenInput === 'right' ? 'border-yellow-500 bg-yellow-50 text-yellow-800' : 'border-gray-100 bg-white text-gray-500 hover:border-yellow-200'">
                                <lucide-icon [img]="ArrowRight" class="w-8 h-8 mb-2"></lucide-icon>
                                <span class="font-bold">Rechts</span>
                            </button>
                        </div>
                    </div>

                    <button (click)="handleAddStep()"
                        class="w-full bg-yellow-500 text-white py-3 rounded-lg font-bold hover:bg-yellow-600 transition shadow-md flex items-center justify-center gap-2">
                        <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Toevoegen aan Route
                    </button>
                </div>
            </div>

            <!-- Preview Box -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 flex flex-col items-center">
                <h3 class="text-sm font-bold text-gray-500 uppercase mb-4">Voorbeeld</h3>
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 w-full flex justify-center">
                    <div class="w-48 h-48 flex items-center justify-center">
                        <app-ogen-face [direction]="ogenInput" [theme]="ogenTheme" [size]="150"></app-ogen-face>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: List -->
        <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Route Stappen ({{ steps.length }})</h2>
                <div *ngIf="steps.length === 0"
                    class="text-center py-12 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200">
                    Nog geen stappen toegevoegd.
                </div>
                <div *ngIf="steps.length > 0" class="space-y-2">
                    <div *ngFor="let step of steps; let index = index"
                        class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100 hover:border-yellow-200 transition">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-8 h-8 bg-yellow-100 text-yellow-700 rounded-full flex items-center justify-center font-bold text-sm">
                                {{ index + 1 }}
                            </div>
                            <div
                                class="w-16 h-16 flex items-center justify-center bg-white rounded border border-gray-200 flex-shrink-0">
                                <app-ogen-face [direction]="step.direction" [theme]="ogenTheme"
                                    [size]="50"></app-ogen-face>
                            </div>
                            <div>
                                <span class="font-bold text-gray-700">
                                    <ng-container *ngIf="step.direction === 'left'">Linksaf</ng-container>
                                    <ng-container *ngIf="step.direction === 'right'">Rechtsaf</ng-container>
                                    <ng-container *ngIf="step.direction === 'straight'">Rechtdoor</ng-container>
                                </span>
                            </div>
                        </div>
                        <button (click)="handleRemoveStep(step.id)"
                            class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded transition">
                            <lucide-icon [img]="Trash2" class="w-5 h-5"></lucide-icon>
                        </button>
                    </div>
                </div>

                <!-- Live Preview of Full Route -->
                <div *ngIf="steps.length > 0" class="mt-8 border-t pt-8">
                    <h3 class="text-lg font-bold mb-4">Totaaloverzicht</h3>
                    <app-ogen-route [steps]="steps" [theme]="ogenTheme"></app-ogen-route>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<!-- HELICOPTER MODE UI -->
<ng-container *ngIf="routeType === 'helicopter'">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Input -->
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-blue-100">
                <h2 class="text-xl font-bold text-blue-800 mb-4 flex items-center gap-2">
                    <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Nieuwe Vector
                </h2>

                <div class="space-y-6">
                    <!-- Scale Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Schaal (1cm = ... meter)</label>
                        <input type="number" min="1" [ngModel]="heliScale" (ngModelChange)="updateHeliScale($event)"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>

                    <div class="border-t border-gray-200 my-4"></div>

                    <!-- Degrees Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Graden (0-360)</label>
                        <input type="number" min="0" max="360" [(ngModel)]="heliInput.degrees"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>

                    <!-- Distance Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Afstand (cm)</label>
                        <input type="number" min="0" step="0.5" [(ngModel)]="heliInput.distance"
                            class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" />
                    </div>

                    <button (click)="handleAddStep()"
                        class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition shadow-md flex items-center justify-center gap-2">
                        <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Toevoegen aan Route
                    </button>
                </div>
            </div>

            <!-- Preview Box -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 flex flex-col items-center">
                <h3 class="text-sm font-bold text-gray-500 uppercase mb-4">Voorbeeld</h3>
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 w-full flex justify-center">
                    <!-- Render preview of JUST this step -->
                    <div class="w-64 h-64 overflow-hidden transform scale-75">
                        <app-helicopter-route [steps]="[{ degrees: heliInput.degrees, distance: heliInput.distance }]"
                            [scale]="heliScale"></app-helicopter-route>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: List -->
        <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Route Stappen ({{ steps.length }})</h2>
                <div *ngIf="steps.length === 0"
                    class="text-center py-12 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200">
                    Nog geen vectoren toegevoegd.
                </div>
                <div *ngIf="steps.length > 0" class="space-y-2">
                    <div *ngFor="let step of steps; let index = index"
                        class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100 hover:border-blue-200 transition">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-8 h-8 bg-blue-100 text-blue-700 rounded-full flex items-center justify-center font-bold text-sm">
                                {{ index + 1 }}
                            </div>
                            <div>
                                <span class="font-bold text-gray-700">
                                    {{ step.degrees }}Â° - {{ step.distance }} cm
                                </span>
                            </div>
                        </div>
                        <button (click)="handleRemoveStep(step.id)"
                            class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded transition">
                            <lucide-icon [img]="Trash2" class="w-5 h-5"></lucide-icon>
                        </button>
                    </div>
                </div>

                <!-- Live Preview of Full Route -->
                <div *ngIf="steps.length > 0" class="mt-8 border-t pt-8">
                    <h3 class="text-lg font-bold mb-4">Totaaloverzicht</h3>
                    <app-helicopter-route [steps]="steps" [scale]="heliScale"></app-helicopter-route>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<!-- STRIP MODE UI -->
<ng-container *ngIf="routeType === 'strip'">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Input -->
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                <h2 class="text-xl font-bold text-green-800 mb-4 flex items-center gap-2">
                    <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Nieuwe Situatie
                </h2>

                <div class="space-y-6">
                    <!-- Left Strips Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Strepen Links</label>
                        <div class="flex gap-2">
                            <button *ngFor="let num of [0, 1, 2, 3, 4]" (click)="stripInput.left = num"
                                class="w-10 h-10 rounded-lg font-bold transition-colors"
                                [ngClass]="stripInput.left === num ? 'bg-green-600 text-white shadow-md' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'">
                                {{ num }}
                            </button>
                        </div>
                    </div>

                    <!-- Right Strips Input -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Strepen Rechts</label>
                        <div class="flex gap-2">
                            <button *ngFor="let num of [0, 1, 2, 3, 4]" (click)="stripInput.right = num"
                                class="w-10 h-10 rounded-lg font-bold transition-colors"
                                [ngClass]="stripInput.right === num ? 'bg-green-600 text-white shadow-md' : 'bg-gray-100 text-gray-600 hover:bg-gray-200'">
                                {{ num }}
                            </button>
                        </div>
                    </div>

                    <button (click)="handleAddStep()"
                        class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition shadow-md flex items-center justify-center gap-2">
                        <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Toevoegen aan Route
                    </button>
                </div>
            </div>

            <!-- Preview Box -->
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 flex flex-col items-center">
                <h3 class="text-sm font-bold text-gray-500 uppercase mb-4">Voorbeeld</h3>
                <div class="border border-gray-200 rounded-lg p-4 bg-gray-50 w-full flex justify-center">
                    <!-- Render a mini Strippenkaart with just this step -->
                    <div class="h-64 overflow-hidden">
                        <app-strippenkaart
                            [steps]="[{ type: 'strip_entry', left: stripInput.left, right: stripInput.right }]"></app-strippenkaart>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: List -->
        <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Route Stappen ({{ steps.length }})</h2>
                <div *ngIf="steps.length === 0"
                    class="text-center py-12 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200">
                    Nog geen stappen toegevoegd.
                </div>
                <div *ngIf="steps.length > 0" class="space-y-2">
                    <div *ngFor="let step of steps; let index = index"
                        class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100 hover:border-green-200 transition">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-8 h-8 bg-green-100 text-green-700 rounded-full flex items-center justify-center font-bold text-sm">
                                {{ index + 1 }}
                            </div>
                            <div>
                                <span class="font-bold text-gray-700">
                                    Links: {{ step.left }} | Rechts: {{ step.right }}
                                </span>
                            </div>
                        </div>
                        <button (click)="handleRemoveStep(step.id)"
                            class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded transition">
                            <lucide-icon [img]="Trash2" class="w-5 h-5"></lucide-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<!-- TULIP MODE UI (Existing) -->
<ng-container *ngIf="routeType === 'tulip'">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Builder -->
        <div class="lg:col-span-1 space-y-6">

            <!-- Phase 1: Select Type -->
            <div *ngIf="phase === 'SELECT_TYPE'" class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                <h2 class="text-xl font-bold text-green-800 mb-4 flex items-center gap-2">
                    <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Kies Situatie
                </h2>
                <div class="grid grid-cols-2 gap-3">
                    <button *ngFor="let type of intersectionTypes"
                        (click)="setNewStepType(type.id); setPhase('SELECT_ACTION')"
                        class="flex flex-col items-center p-3 border-2 border-gray-100 rounded-lg hover:border-green-500 hover:bg-green-50 transition group">
                        <div class="w-16 h-16 mb-2">
                            <app-tulip-diagram [type]="type.id" [showArrow]="false" [size]="64"></app-tulip-diagram>
                        </div>
                        <span class="text-sm font-medium text-gray-600 group-hover:text-green-700">{{ type.label
                            }}</span>
                    </button>
                </div>
            </div>

            <!-- Phase 2: Select Action (Interactive) -->
            <div *ngIf="phase === 'SELECT_ACTION'" class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-green-800">Waar ga je heen?</h2>
                    <button (click)="setPhase('SELECT_TYPE')"
                        class="text-sm text-gray-500 hover:text-green-600 flex items-center gap-1">
                        <lucide-icon [img]="ArrowLeft" class="w-4 h-4"></lucide-icon> Terug
                    </button>
                </div>

                <div class="flex justify-center bg-gray-50 rounded-lg p-4 border border-gray-200">
                    <app-interactive-tulip [type]="newStep.type"
                        (actionSelect)="setNewStepAction($event); setPhase('CONFIRM')"></app-interactive-tulip>
                </div>
                <p class="text-center text-sm text-gray-500 mt-4">
                    Klik op de weg die je wilt inslaan.
                </p>
            </div>

            <!-- Phase 3: Confirm -->
            <div *ngIf="phase === 'CONFIRM'" class="bg-white p-6 rounded-xl shadow-lg border border-green-100">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold text-green-800">Bevestigen</h2>
                    <button (click)="setPhase('SELECT_ACTION')"
                        class="text-sm text-gray-500 hover:text-green-600 flex items-center gap-1">
                        <lucide-icon [img]="ArrowLeft" class="w-4 h-4"></lucide-icon> Terug
                    </button>
                </div>

                <div class="flex gap-4 items-center mb-6 bg-gray-50 p-4 rounded-lg">
                    <div class="w-24 h-24 bg-white rounded-lg shadow-sm border border-gray-200 flex-shrink-0">
                        <app-tulip-diagram [type]="newStep.type" [action]="newStep.action"
                            [size]="96"></app-tulip-diagram>
                    </div>
                    <div>
                        <p class="font-bold text-lg text-gray-800">{{ getActionLabel(newStep.action) }}</p>
                        <p class="text-gray-500 text-sm">bij {{ getIntersectionLabel(newStep.type) }}</p>
                    </div>
                </div>

                <button (click)="handleAddStep()"
                    class="w-full bg-green-600 text-white py-3 rounded-lg font-bold hover:bg-green-700 transition shadow-md flex items-center justify-center gap-2">
                    <lucide-icon [img]="Plus" class="w-5 h-5"></lucide-icon> Toevoegen aan Route
                </button>
            </div>

        </div>

        <!-- Right Column: List -->
        <div class="lg:col-span-2">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Route Stappen ({{ steps.length }})</h2>
                <div *ngIf="steps.length === 0"
                    class="text-center py-12 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200">
                    Nog geen stappen toegevoegd.
                </div>
                <div *ngIf="steps.length > 0" class="space-y-2">
                    <div *ngFor="let step of steps; let index = index"
                        class="flex items-center justify-between p-4 bg-gray-50 rounded-lg border border-gray-100 hover:border-green-200 transition">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-8 h-8 bg-green-100 text-green-700 rounded-full flex items-center justify-center font-bold text-sm">
                                {{ index + 1 }}
                            </div>
                            <div class="w-12 h-12 bg-white rounded border border-gray-200 flex-shrink-0">
                                <app-tulip-diagram [type]="step.type" [action]="step.action" [size]="48"
                                    [showArrow]="true"></app-tulip-diagram>
                            </div>
                            <div>
                                <p class="font-bold text-gray-700">{{ getActionLabel(step.action) }}</p>
                            </div>
                        </div>
                        <button (click)="handleRemoveStep(step.id)"
                            class="text-red-400 hover:text-red-600 p-2 hover:bg-red-50 rounded transition">
                            <lucide-icon [img]="Trash2" class="w-5 h-5"></lucide-icon>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-container>